<?xml  version="1.0" encoding="utf-8" ?>
<odoo>
	 <template id="monthly_report_footer_inherit" inherit_id="website.layout" >
			<!--  <xpath expr="//header" position="replace">
			</xpath>  -->
		    <xpath expr="//footer" position="replace">
		    </xpath>
     </template>    

	
	<!-- <li>
         <a href="/web#action=budget_expense_management.action_expense_summary" >Expense Summary</a>
    </li> -->
	 
	<template id="new_budget_nav" inherit_id="website.user_navbar" name="Nav Bar Budget">
		<xpath expr="//li[@id='promote-menu']" position="after">
		
		<li class="dropdown">
             <a class="dropdown-toggle o-no-caret waves" data-toggle="dropdown" href="/my_expenses">Expense</a>
             <div class="dropdown-menu oe_promote_menu" role="menu">
                 <a role="menuitem" data-action="promote-current-page" href="/expense_form"  class="dropdown-item">Add Expense</a>
             	 <a role="menuitem" data-action="promote-current-page" href="/my_expenses"  class="dropdown-item">My Expenses</a>
             </div>
        </li>
        <li class="dropdown">
             <a class="dropdown-toggle o-no-caret waves" data-toggle="dropdown" href="/my_incomes">Income</a>
             <div class="dropdown-menu oe_promote_menu" role="menu">
                 <a role="menuitem" data-action="promote-current-page" href="/income_form"  class="dropdown-item">Add Income</a>
             	 <a role="menuitem" data-action="promote-current-page" href="/my_incomes"  class="dropdown-item">My Income</a>
             </div>
        </li>
		 <li class="nav-item">
	        <a class="nav-link" href="/cash_transfer">Cash Transfer</a>
	      </li>
	      <li>
	    	 <a class="nav-link" href="/budget_monthly_rpt/">Budget Expense Summary</a>
	      </li>
	       <li>
	    	 <a class="nav-link" href="/annual_summary/">Annual Summary</a>
	      </li>
		</xpath>
		<xpath expr="//li[@id='promote-menu']" position="replace">
		</xpath>
		<xpath expr="//li[@id='customize-menu']" position="replace">
		</xpath>
		<xpath expr="//li[@id='content-menu']" position="replace">
		</xpath>
		<xpath expr="//li[@groups='website.group_multi_website']" position="replace">
		</xpath>
	</template>
	
     <template id="budget_montly_report_template" name="Montly report" >
	 	<t t-call="website.layout">
	    	<div class="oe_structure">
	        	<div class="section">
	        	<div class="row mt-2">
	        		<div class="col-lg-4" >
	        			  <h4 style="color:#417c8a;text-align:center;"><t t-esc="current_month"/> Budget</h4>
	        		</div>
	        		<div class="col-lg-4" style="text-align:center;">
	        		<input type="hidden" t-att-value="current_month" id="current_month"/>
	        		<input type="hidden" t-att-value="current_year" id="current_year"/>
	        			  <h4 style="color:#417c8a;" >
				           		  
				           <select id="change_month" class="new" style="font-size: 1rem;width:30%; padding-left: 22px; height: 32px;">
				           
		                            <t t-foreach='month' t-as='m'>
		                                <option t-value="m" t-att-selected="m == current_month">
		                                    <t t-esc='m' />
		                                </option>
		                            </t>
		                     </select>  
		                     
		                     <select id="change_year" style="font-size: 1rem;width:24%; padding-left:22px; height: 32px;">
		                            <t t-foreach='years' t-as='year'>
		                            <!-- <input type="text" t-att-value="year" />
		                             <input type="text" t-att-value="current_year" /> -->
		                                <option t-att-value="year" t-att-selected="year == current_year">
		                                    <t t-esc='year' />
		                                </option>
		                            </t>
		                     </select>  
				           		 
				           </h4>
			            	           
				 	      
	        		</div>
	        		
	        	</div>
	        	
	            <div  class="row pt-2" style="color:#334960;">
	            	<t t-set="exp_categories" t-value="exp_categories"/>
	            	<t t-set="income_details" t-value="income_details" />
	            	<div class="col-lg-4" >	 
	            		
	            	           		
 			            <h4  class="card-header bar text-center">Expenses</h4>
			            <div class="table-responsive ">
				            <table class="table" border="1" style="border:1px solid #a0783bd1;" id="expense">
				            	 <thead>
								    <tr >
								        <th style="border-right:1px solid #dee2e6;">Category</th>
								        <th style="border-right:1px solid #dee2e6;">Budgeted</th>
								        <th style="border-right:1px solid #dee2e6;">Spent</th>
								        <th style="border-right:1px solid #dee2e6;">Remaining</th>
								
								    </tr>
								  </thead>
								    <tbody>
								          <t t-foreach='exp_categories.keys()' t-as='exp'>
								          
								          
								          
									       <tr >
									          	<td style="border-right:1px solid #dee2e6;"><t t-esc="exp.name"/></td>
									          	<td style="border-right:1px solid #dee2e6;" ><t t-esc="'%.2f'% exp_categories[exp]['budgeted']"/></td>
									          	<td style="border-right:1px solid #dee2e6;" ><t t-esc="'%.2f'% exp_categories[exp]['spent']"/></td>
									          	<t t-set="remaining" t-value="('%.2f'% (exp_categories[exp]['budgeted'] - exp_categories[exp]['spent']))"/>
									          	<td style="border-right:1px solid #dee2e6;">
									          		<t t-if="remaining and (float(remaining) &gt;= 0)">$<t t-esc="'%.2f'% (exp_categories[exp]['budgeted'] - exp_categories[exp]['spent'])"/></t>
													<t t-if="remaining and (float(remaining) &lt; 0)"><span  style="color:red;">-$<t t-esc="abs(float(remaining))"/></span></t>
									          	
									          	</td>
									       </tr> 
										  </t>
										  <tr class="card-footer bar " >
										  		<td style="border-right:1px solid #4da4c5;"><strong>Total</strong></td>
									          	<td style="border-right:1px solid #4da4c5; font-weight:bold;">$<t  t-esc="round(sum([exp_categories[exp]['budgeted'] for exp in exp_categories.keys()]))" /> </td>
      										    <td style="border-right:1px solid #4da4c5; font-weight:bold;">$<t  t-esc="round(sum([exp_categories[exp]['spent'] for exp in exp_categories.keys()]))" /> </td>
      										    
      										     <t t-set="diff" t-value="round(sum([(exp_categories[exp]['budgeted'] - exp_categories[exp]['spent']) for exp in exp_categories.keys()]))"/>
									          		<td style="border-right:1px solid #4da4c5;">
									          			<t t-if="diff and (diff &gt;= 0)"><span  style="font-weight:bold;">$<t t-esc="diff"/></span></t>
														<t t-if="diff and (diff &lt; 0)"><span  style="font-weight:bold;">-$<t t-esc="abs(diff)"/></span></t>
									          		</td>
									      </tr>
									</tbody> 
								</table>
							</div>		 	        
 						</div>
 
		            <div class="col-lg-4" >
				 	       <div >
					 	       
					            <h4  class="card-header bg-primary text-center">Income</h4>
					            <div class="table-responsive ">
						            <table class="table" border="1" style="border:1px solid #dee2e6;">
						            	<thead>
										    <tr >
										   		<th style="border-right:1px solid #dee2e6;">Category</th>
										        <th style="border-right:1px solid #dee2e6;">Planned</th>
										        <th style="border-right:1px solid #dee2e6;">Actual</th>
										        <th style="border-right:1px solid #dee2e6;">Diff</th>
										    </tr>
										  </thead>
										  <tbody>
										  		<t t-foreach='income_details.keys()' t-as='inc'>
										          <tr>
										          	<td style="border-right:1px solid #dee2e6;"><t t-esc="inc.name"/></td>
										          	<td style="border-right:1px solid #dee2e6;"><t t-esc="'%.2f'% income_details[inc]['planned']"/></td>
										          	<td style="border-right:1px solid #dee2e6;"><t t-esc="'%.2f'% income_details[inc]['actual']"/></td>
										          	<t t-set="diff" t-value="'%.2f'% (income_details[inc]['actual'] - income_details[inc]['planned'])"/>
									          		<td style="border-right:1px solid #dee2e6;">
									          		<t t-if="diff and (float(diff) &gt;= 0)">$<t t-esc="diff"/></t>
													<t t-if="diff and (float(diff) &lt; 0)"><span  style="color:red;">-$<t t-esc="abs(float(diff))"/></span></t>
									          	
									          	</td>
										          </tr> 
												</t>
												 <tr class="card-footer bg-primary">
											  		<td style="border-right:1px solid #00A09D;"><strong>Total</strong></td>
										          	<td style="border-right:1px solid #00A09D; font-weight:bold;">$<t  t-esc="round(sum([income_details[inc]['planned'] for inc in income_details.keys()]))" /> </td>
										          	<td style="border-right:1px solid #00A09D; font-weight:bold;">$<t  t-esc="round(sum([income_details[inc]['actual'] for inc in income_details.keys()]))" /> </td>
s											        <t t-set="diff" t-value="round(sum([(income_details[inc]['actual'] - income_details[inc]['planned']) for inc in income_details.keys()]))"/>
									          		<td style="border-right:1px solid #dee2e6;">
									          			<t t-if="diff and (diff &gt;= 0)"><span  style="font-weight:bold;">$<t t-esc="diff"/></span></t>
														<t t-if="diff and (diff &lt; 0)"><span  style="font-weight:bold;">-$<t t-esc="abs(diff)"/></span></t>
									          		</td>
											      </tr>
									      </tbody>
									</table>
								</div>
						   </div>
	        			   <t t-set="monthly_income" t-value="sum([income_details[inc]['actual'] for inc in income_details.keys()])" /> 
						        <t t-set="monthly_spent" t-value="sum([exp_categories[exp]['spent'] for exp in exp_categories.keys()])" /> 
						         <div class="table-responsive savings_summary_box">
						            <table>
						            	<tbody>
						            		<p><span style= "font-size: 15px; font-style: italic;">Increase in total savings</span></p>
						            		<tr><span style="font-weight: bold;font-size: 22px;">$<t t-esc="round(monthly_income - monthly_spent)" /></span></tr>
						            		<p><span style= "font-size: 15px;">Saved this month</span></p>
						            	</tbody>
									</table>
								</div>
								
						         <div class="table-responsive savings_summary_box invest">
						            <table>
						            	<tbody>
						            		<p><span style= "font-size: 15px; font-style: italic;">Total investment this month</span></p>
						            		<tr><span style="font-weight:bold; font-size: 22px;">$<t t-esc="investment"/></span></tr>
						            	</tbody>
									</table>
								</div>
		 	       	</div>
		 	       
		 	        <div class="col-lg-4" >
						     
					            <h4  class="card-header bg-secondary text-center">Accounts</h4>
					            <div class="table-responsive ">
						            <table class="table" border="1" style="border:1px solid #dee2e6;">
						            	<thead>
										    <tr >
										   		<th style="border-right:1px solid #dee2e6;">Account name</th>
										        <th style="border-right:1px solid #dee2e6;">Spent</th>
										        <th >Balance</th>
										
										    </tr>
										  </thead>
										  <tbody>
										  		<t t-foreach='account_details.keys()' t-as='acc'>
										           <tr>
										          	<td style="border-right:1px solid #dee2e6;"><t t-esc="acc.name"/></td>
										          	<td style="border-right:1px solid #dee2e6;">$<t t-esc="round(account_details[acc]['amt_spent'])"/></td>
					
										          	<t t-set="balance" t-value="'%.2f'% account_details[acc]['balance']"/>
									          		<td style="border-right:1px solid #dee2e6;">
									          			<t t-if="balance and (float(balance) &gt;= 0)">$<t t-esc="balance"/></t>
														<t t-if="balance and (float(balance) &lt; 0)"><span  style="color:red;">-$<t t-esc="abs(float(balance))"/></span></t>
									          		</td>
										          </tr>  
												</t>
												 <tr class="card-footer bg-secondary">
											          	<td style="border-right:1px solid #875A7B;"><strong>Total</strong></td>
											          	<td style="border-right:1px solid #875A7B; font-weight:bold;">$<t t-esc="round(sum([account_details[acct]['amt_spent'] for acct in account_details.keys()]))" /> </td>
		      										    <td style="border-right:1px solid #875A7B; font-weight:bold;">$<t t-esc="round(sum([account_details[acct]['balance'] for acct in account_details.keys()]))" /> </td>
											     </tr>
									      </tbody>
										</table>
								</div>
							</div>			 
		 	       		</div>
	 	            </div>
	 	        </div>
	    </t>
	 </template>
	  
	
	 <record id="monthly_report_action" model="ir.actions.act_url">
                <field name="name">Montly Report</field>
                <field name="type">ir.actions.act_url</field>
                <field name="target">self</field>
                <field name="domain"></field>
                <field name="url">/budget_monthly_rpt/</field>
        </record>
	<menuitem id="monthly_summary_menu" name="Summary" action="monthly_report_action" string="Monthly Report"  parent="budget" />
	 
</odoo>